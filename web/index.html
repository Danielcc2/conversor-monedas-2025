<!doctype html>
<html lang="es">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Dael-viajes · Viaja y Convierte Divisas</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Sora:wght@500;700;800&display=swap" rel="stylesheet">
    <style>
      :root { --bg: #0b1220; --panel: #0f172a; --text: #e5e7eb; --muted: #9ca3af; --primary: #10b981; --accent: #22d3ee; }
      * { box-sizing: border-box; }
      body { font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica, Arial; background: radial-gradient(1200px 600px at 20% 10%, rgba(34,211,238,.12), transparent), radial-gradient(900px 500px at 80% 20%, rgba(16,185,129,.12), transparent), var(--bg); color: var(--text); margin: 0; }
      .wrap { max-width: 1100px; margin: 0 auto; padding: 40px 20px; }
      header { position: sticky; top:0; display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px; z-index:50 }
      .brand { display: flex; gap: 12px; align-items: center; font-family: 'Sora', ui-sans-serif, system-ui; font-weight: 800; letter-spacing: .3px; }
      .brand .logo { width: 44px; height: 44px; border-radius: 12px; background: radial-gradient(circle at 35% 35%, var(--accent), transparent 55%), linear-gradient(135deg, var(--primary), #0ea5e9); display: grid; place-items: center; color: #052e2b; font-weight: 900; box-shadow:0 8px 20px rgba(0,0,0,.35); }
      .brand .wordmark { font-size: 1.2rem; letter-spacing: .6px; }
      .hero { display: grid; grid-template-columns: 1.2fr 1fr; gap: 24px; align-items: center; }
      .nav { display:flex; gap: 24px; align-items:center; font-weight:700; font-family: 'Sora', ui-sans-serif, system-ui; }
      .nav a { color: #e5e7eb; text-decoration:none; font-size: 1rem; }
      .nav a.locked { opacity:.5; cursor:not-allowed; }
      /* User menu */
      .user { position: relative; }
      .user-btn { background:linear-gradient(135deg,#0b1220,#0e162b); border:1px solid #1f2937; color:#e5e7eb; padding:8px 12px; border-radius:999px; cursor:pointer; box-shadow:0 6px 16px rgba(0,0,0,.25); }
      .dropdown { position:absolute; right:0; top:calc(100% + 8px); background:#0b1220; border:1px solid #1f2937; border-radius:12px; min-width:220px; box-shadow:0 18px 40px rgba(0,0,0,.45); display:none; overflow:hidden; }
      .dropdown.open { display:block; }
      .dropdown .dd-header { padding:10px 12px; font-size:.85rem; color:#9ca3af; border-bottom:1px solid #1f2937; }
      .dropdown a { display:block; padding:12px 14px; color:#e5e7eb; text-decoration:none; }
      .dropdown a:hover { background:#111827; }
      .hero h1 { font-size: 2rem; line-height: 1.2; margin: 0 0 10px; }
      .hero p { color: var(--muted); margin: 0 0 16px; }
      .card { background: var(--panel); border: 1px solid #1f2937; border-radius: 14px; padding: 18px; box-shadow: 0 12px 30px rgba(0,0,0,.25); }
      label { font-size: .9rem; color: var(--muted); display: block; margin: 8px 0 6px; }
      input, button { width: 100%; padding: 12px 14px; border-radius: 10px; border: 1px solid #1f2937; background: #0b1220; color: var(--text); }
      input:focus, button:focus { outline: none; border-color: #2563eb; box-shadow: 0 0 0 3px rgba(37,99,235,.25); }
      button.primary { background: var(--primary); color: #052e2b; border: none; font-weight: 700; cursor: pointer; margin-top: 12px; }
      .two { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }
      .hint { color: var(--muted); font-size: .9rem; }
      .illu { aspect-ratio: 4/3; border-radius: 14px; border: 1px solid #1f2937; background: linear-gradient(135deg, rgba(34,211,238,.15), transparent), url('https://images.unsplash.com/photo-1526778548025-fa2f459cd5c1?q=80&w=1200&auto=format&fit=crop') center/cover no-repeat; box-shadow: 0 12px 30px rgba(0,0,0,.25); }
      @media (max-width: 900px) { .hero { grid-template-columns: 1fr; } .illu { order: -1; height: 220px; } }
    </style>
  </head>
  <body>
    <div class="wrap">
      <header>
        <div class="brand">
          <div class="logo" aria-hidden="true">
            <svg width="26" height="26" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M2 20l20-8-20-8 6 8-6 8z" fill="#052e2b" opacity=".15"/>
              <path d="M2 12l20 0" stroke="#052e2b" stroke-width="1.5" opacity=".2"/>
              <path d="M3 10l7 2-3-6 3-2 4 6 7 2-7 2-4 6-3-2 3-6-7 2z" fill="#052e2b"/>
            </svg>
          </div>
          <div class="wordmark">Dael‑viajes</div>
        </div>
        <nav class="nav" id="topNav">
          <a href="#" data-route="/blog" class="locked">Blog de viajes</a>
          <a href="#" data-route="/destinos" class="locked">Destinos y guías</a>
          <a href="#" data-route="/presupuestos" class="locked">Presupuestos y divisas</a>
          <a href="#" data-route="/consejos" class="locked">Consejos y seguridad</a>
          <a href="#" data-route="/diario" class="locked">Mi diario</a>
        </nav>
        <div class="user" id="userArea" style="display:none">
          <button id="userBtn" class="user-btn"><span id="userName">—</span> ▾</button>
          <div id="userDropdown" class="dropdown">
            <div class="dd-header">Dael‑viajes</div>
            <a href="/divisas">Conversor</a>
            <a href="#" id="menuLogout">Cerrar sesión</a>
          </div>
        </div>
      </header>

      <section class="hero">
        <div>
          <h1>Planifica tu próximo viaje con divisas claras</h1>
          <p>Regístrate o inicia sesión para guardar tus preferencias y convertir divisas al instante. Sin complicaciones, con estilo viajero.</p>
          <div class="two">
            <div class="card">
              <h3>Iniciar sesión</h3>
              <label for="loginEmail">Email</label>
              <input id="loginEmail" type="email" placeholder="tú@correo.com" />
              <label for="loginPass">Contraseña</label>
              <input id="loginPass" type="password" placeholder="••••••••" />
              <button id="loginBtn" class="primary">Entrar</button>
            </div>
            <div class="card">
              <h3>Crear cuenta</h3>
              <label for="regName">Nombre de viajero</label>
              <input id="regName" type="text" placeholder="Aventurero/a" />
              <label for="regEmail">Email</label>
              <input id="regEmail" type="email" placeholder="tú@correo.com" />
              <label for="regPass">Contraseña</label>
              <input id="regPass" type="password" placeholder="••••••••" />
              <button id="regBtn" class="primary">Registrarme</button>
              <p class="hint">Al registrarte se creará tu espacio personal y te llevaremos al conversor.</p>
            </div>
          </div>
        </div>
        <div class="illu" aria-hidden="true"></div>
      </section>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
      const SUPABASE_URL = 'https://ubqsbofiyhearumlmdif.supabase.co';
      const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVicXNib2ZpeWhlYXJ1bWxtZGlmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc1MjczNzUsImV4cCI6MjA3MzEwMzM3NX0.CpXG7JL7sOb1Rdn0BMyqN9MxsV13UMpSwazuhQt8jlE';
      const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
      window.sb = supabase; // Exponer cliente para depuración en consola
      const $ = (id) => document.getElementById(id);
      function slugify(name){ return String(name||'').toLowerCase().trim().replace(/[^a-z0-9]+/g,'-').replace(/(^-|-$)/g,''); }

      function enableNavLinks(){
        document.querySelectorAll('[data-route]')?.forEach(a=>{
          a.classList.remove('locked');
          a.addEventListener('click', (e)=>{
            e.preventDefault();
            const route = a.getAttribute('data-route');
            if(route) window.location.href = route;
          });
        });
      }
      function showUserMenu(name){
        const area = document.getElementById('userArea');
        const nameEl = document.getElementById('userName');
        if (area && nameEl){ area.style.display='block'; nameEl.textContent = name || 'Usuario';
          const btn = document.getElementById('userBtn');
          const dd = document.getElementById('userDropdown');
          btn?.addEventListener('click', (e)=>{ e.preventDefault(); dd?.classList.toggle('open'); });
          document.addEventListener('click', (e)=>{ if(!dd) return; if(!dd.contains(e.target) && !btn.contains(e.target)) dd.classList.remove('open'); });
          document.getElementById('menuLogout')?.addEventListener('click', async (e)=>{ e.preventDefault(); await supabase.auth.signOut(); location.reload(); });
        }
      }

      async function register(){
        const name = $('regName').value.trim();
        const email = $('regEmail').value.trim().toLowerCase();
        const pass = $('regPass').value;
        if(!name || !email || !pass){ alert('Completa todos los campos'); return; }
        const { data, error } = await supabase.auth.signUp({
          email,
          password: pass,
          options: { data: { name } }
        });
        if (error) { alert('Error al registrar: ' + error.message); return; }
        const slug = slugify(name);
        if (data.session) {
          history.replaceState({}, '', `#/viajero/${slug}`);
          enableNavLinks();
          showUserMenu(name);
        } else {
          alert('Revisa tu correo para confirmar el registro.');
        }
      }

      async function login(){
        const email = $('loginEmail').value.trim().toLowerCase();
        const password = $('loginPass').value;
        const { data, error } = await supabase.auth.signInWithPassword({ email, password });
        if (error) { alert('Credenciales inválidas'); return; }
        // Intentar obtener nombre del perfil si existe
        const { data: userData } = await supabase.auth.getUser();
        const name = userData?.user?.user_metadata?.name || email.split('@')[0];
        const slug = slugify(name);
        history.replaceState({}, '', `#/viajero/${slug}`);
        enableNavLinks();
        showUserMenu(name);
      }

      $('regBtn').addEventListener('click', register);
      $('loginBtn').addEventListener('click', login);

      // Si hay sesión, habilitar navegación al cargar; si no, mostrar aviso al pulsar
      (async () => {
        const { data } = await supabase.auth.getUser();
        if (data?.user){
          enableNavLinks();
          const name = data.user.user_metadata?.name || (data.user.email ? data.user.email.split('@')[0] : '');
          showUserMenu(name);
        }
        document.querySelectorAll('[data-route].locked')?.forEach(a=>{
          a.addEventListener('click', (e)=>{ e.preventDefault(); alert('Inicia sesión para acceder a esta sección.'); });
        });
      })();
    </script>
  </body>
  </html>
