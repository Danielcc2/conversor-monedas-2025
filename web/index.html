<!doctype html>
<html lang="es">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Dael-viajes · Viaja y Convierte Divisas</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Sora:wght@500;700;800&display=swap" rel="stylesheet">
    <style>
      :root { --bg: #0b1220; --panel: #0f172a; --text: #e5e7eb; --muted: #9ca3af; --primary: #10b981; --accent: #22d3ee; }
      * { box-sizing: border-box; }
      body { font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica, Arial; background: radial-gradient(1200px 600px at 20% 10%, rgba(34,211,238,.12), transparent), radial-gradient(900px 500px at 80% 20%, rgba(16,185,129,.12), transparent), var(--bg); color: var(--text); margin: 0; }
      .wrap { max-width: 1100px; margin: 0 auto; padding: 40px 20px; }
      header { position: sticky; top:0; margin-bottom: 24px; z-index:50 }
      .mainnav { display:grid; grid-template-columns: 1fr auto 1fr; align-items:center; gap:18px; }
      .nav-left,.nav-right{ display:flex; gap:22px; align-items:center; justify-content:flex-start }
      .nav-right{ justify-content:flex-end }
      .mainnav a { color:#e5e7eb; text-decoration:none; font-weight:700; font-family:'Sora',ui-sans-serif,system-ui; font-size:1.12rem }
      .mainnav a.locked { opacity:.5; cursor:not-allowed }
      .nav-logo img{ width:64px; height:64px }
      .hamburger { display:none; width:40px; height:40px; border:1px solid #1f2937; background:#0b1220; border-radius:10px; align-items:center; justify-content:center; cursor:pointer }
      .hamburger span { display:block; width:18px; height:2px; background:#e5e7eb; position:relative }
      .hamburger span::before, .hamburger span::after { content:""; position:absolute; left:0; width:18px; height:2px; background:#e5e7eb }
      .hamburger span::before { top:-6px } .hamburger span::after { top:6px }
      .mobile-menu { position:fixed; inset:0; background:rgba(2,6,23,.7); backdrop-filter:blur(6px); display:none; z-index:70 }
      .mobile-menu.open { display:block }
      .mobile-sheet { position:absolute; top:0; right:0; width:78%; max-width:340px; height:100%; background:#0b1220; border-left:1px solid #1f2937; padding:16px }
      .mobile-sheet a { display:block; padding:12px 8px; color:#e5e7eb; text-decoration:none; font-weight:700 }
      .mobile-close { background:transparent; border:1px solid #1f2937; color:#e5e7eb; padding:8px 10px; border-radius:10px; }
      .hero { display: grid; grid-template-columns: 1.2fr 1fr; gap: 24px; align-items: stretch; }
      .nav { display:flex; gap: 24px; align-items:center; font-weight:700; font-family: 'Sora', ui-sans-serif, system-ui; }
      .nav a { color: #e5e7eb; text-decoration:none; font-size: 1rem; }
      .nav a.locked { opacity:.5; cursor:not-allowed; }
      /* User menu */
      .user { position: relative; }
      .user-btn { background:linear-gradient(135deg,#0b1220,#0e162b); border:1px solid #1f2937; color:#e5e7eb; padding:8px 12px; border-radius:999px; cursor:pointer; box-shadow:0 6px 16px rgba(0,0,0,.25); }
      .dropdown { position:absolute; right:0; top:calc(100% + 8px); background:#0b1220; border:1px solid #1f2937; border-radius:12px; min-width:220px; box-shadow:0 18px 40px rgba(0,0,0,.45); display:none; overflow:hidden; }
      .dropdown.open { display:block; }
      .dropdown .dd-header { padding:10px 12px; font-size:.85rem; color:#9ca3af; border-bottom:1px solid #1f2937; }
      .dropdown a { display:block; padding:12px 14px; color:#e5e7eb; text-decoration:none; }
      .dropdown a:hover { background:#111827; }
      .hero h1 { font-family:'Sora',ui-sans-serif,system-ui; font-weight:800; font-size:2.4rem; line-height:1.2; margin:0 0 10px; letter-spacing:.2px }
      .hero p { color: var(--muted); margin: 0 0 16px; }
      .card { background: var(--panel); border: 1px solid #1f2937; border-radius: 14px; padding: 18px; box-shadow: 0 12px 30px rgba(0,0,0,.25); }
      label { font-size: .9rem; color: var(--muted); display: block; margin: 8px 0 6px; }
      input, button { width: 100%; padding: 12px 14px; border-radius: 10px; border: 1px solid #1f2937; background: #0b1220; color: var(--text); }
      input:focus, button:focus { outline: none; border-color: #2563eb; box-shadow: 0 0 0 3px rgba(37,99,235,.25); }
      button.primary { background: var(--primary); color: #052e2b; border: none; font-weight: 700; cursor: pointer; margin-top: 12px; }
      .two { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }
      .hint { color: var(--muted); font-size: .9rem; }
      .illu { aspect-ratio: 4/3; border-radius: 14px; border: 1px solid #1f2937; background: linear-gradient(135deg, rgba(34,211,238,.15), transparent), url('https://images.unsplash.com/photo-1526778548025-fa2f459cd5c1?q=80&w=1200&auto=format&fit=crop') center/cover no-repeat; box-shadow: 0 12px 30px rgba(0,0,0,.25); }
      @media (max-width: 900px) {
        .mainnav a { font-size:1rem }
        .hero { grid-template-columns: 1fr; }
        .illu { order: -1; height: 220px; }
        .hero h1 { font-size:2.1rem }
      }
      @media (max-width: 720px){
        .mainnav { grid-template-columns: 40px auto 40px }
        .nav-left,.nav-right { display:none }
        .hamburger { display:flex }
        .mainnav a { font-size:1rem }
      }
    </style>
  </head>
  <body>
    <div class="wrap">
      <header>
        <div class="mainnav">
          <div class="nav-left">
            <a href="#" data-route="/blog" class="locked">Blog</a>
            <a href="#" data-route="/destinos" class="locked">Destinos</a>
          </div>
          <a class="nav-logo" href="/"><img src="/assets/Dael-viajes.png" alt="Dael‑viajes"></a>
          <div class="nav-right">
            <a href="#" data-route="/presupuestos" class="locked">Presupuestos</a>
            <a href="#" data-route="/consejos" class="locked">Consejos</a>
            <a href="#" data-route="/diario" class="locked">Diario</a>
            <div class="user" id="userArea" style="display:none">
              <button id="userBtn" class="user-btn"><span id="userName">—</span> ▾</button>
              <div id="userDropdown" class="dropdown">
                <div class="dd-header">Dael‑viajes</div>
                <a href="/divisas">Conversor</a>
                <a href="#" id="menuLogout">Cerrar sesión</a>
              </div>
            </div>
          </div>
          <button id="burgerBtn" class="hamburger" aria-label="Abrir menú" title="Menú"><span></span></button>
        </div>
      </header>

      <div id="mobileMenu" class="mobile-menu" aria-hidden="true">
        <div class="mobile-sheet">
          <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
            <strong>Menú</strong>
            <button id="mobileClose" class="mobile-close">Cerrar</button>
          </div>
          <a href="/blog">Blog</a>
          <a href="/destinos">Destinos</a>
          <a href="/presupuestos">Presupuestos</a>
          <a href="/consejos">Consejos</a>
          <a href="/diario">Diario</a>
          <hr style="border:0;border-top:1px solid #1f2937;margin:10px 0">
          <a href="/divisas">Conversor</a>
        </div>
      </div>

      <section class="hero">
        <div>
          <h1>Planifica tu próximo viaje con divisas claras</h1>
          <div class="card" id="authCard" style="max-width:560px">
            <div style="display:flex; gap:8px; background:#0b1220; border:1px solid #1f2937; padding:4px; border-radius:10px; width:max-content; margin-bottom:12px">
              <button id="tabLogin" class="primary" style="margin:0; padding:8px 12px; background:#10b981; color:#052e2b; border:none; border-radius:8px">Iniciar sesión</button>
              <button id="tabRegister" style="margin:0; padding:8px 12px; background:transparent; color:#e5e7eb; border:none; border-radius:8px">Crear cuenta</button>
            </div>
            <form id="authForm" onsubmit="return false;">
              <div id="groupName" style="display:none">
                <label for="name">Nombre de viajero</label>
                <input id="name" type="text" placeholder="Aventurero/a" autocomplete="name" />
              </div>
              <label for="email">Email</label>
              <input id="email" type="email" placeholder="tú@correo.com" autocomplete="email" />
              <label for="password">Contraseña</label>
              <input id="password" type="password" placeholder="••••••••" autocomplete="current-password" />
              <button id="authSubmit" class="primary" style="width:100%; margin-top:14px">Entrar</button>
              <p id="authHint" class="hint" style="margin-top:8px">¿No tienes cuenta? Cambia a “Crear cuenta”.</p>
              <div id="authMsg" class="hint" style="margin-top:8px; color:#a3e635"></div>
            </form>
          </div>
        </div>
        <div class="illu" aria-hidden="true"></div>
      </section>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
      const SUPABASE_URL = 'https://ubqsbofiyhearumlmdif.supabase.co';
      const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVicXNib2ZpeWhlYXJ1bWxtZGlmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc1MjczNzUsImV4cCI6MjA3MzEwMzM3NX0.CpXG7JL7sOb1Rdn0BMyqN9MxsV13UMpSwazuhQt8jlE';
      const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
      window.sb = supabase; // Exponer cliente para depuración en consola
      const $ = (id) => document.getElementById(id);
      function slugify(name){ return String(name||'').toLowerCase().trim().replace(/[^a-z0-9]+/g,'-').replace(/(^-|-$)/g,''); }

      function enableNavLinks(){
        document.querySelectorAll('[data-route]')?.forEach(a=>{
          a.classList.remove('locked');
          a.addEventListener('click', (e)=>{
            e.preventDefault();
            const route = a.getAttribute('data-route');
            if(route) window.location.href = route;
          });
        });
      }
      function showUserMenu(name){
        const area = document.getElementById('userArea');
        const nameEl = document.getElementById('userName');
        if (area && nameEl){ area.style.display='block'; nameEl.textContent = name || 'Usuario';
          const btn = document.getElementById('userBtn');
          const dd = document.getElementById('userDropdown');
          btn?.addEventListener('click', (e)=>{ e.preventDefault(); dd?.classList.toggle('open'); });
          document.addEventListener('click', (e)=>{ if(!dd) return; if(!dd.contains(e.target) && !btn.contains(e.target)) dd.classList.remove('open'); });
          document.getElementById('menuLogout')?.addEventListener('click', async (e)=>{ e.preventDefault(); await supabase.auth.signOut(); location.reload(); });
        }
      }

      // Auth minimalista unificado
      let mode = 'login'; // 'login' | 'register'
      function setMode(m){
        mode = m;
        const isReg = mode === 'register';
        $('groupName').style.display = isReg ? 'block' : 'none';
        $('authSubmit').textContent = isReg ? 'Crear cuenta' : 'Entrar';
        $('authHint').textContent = isReg ? '¿Ya tienes cuenta? Cambia a “Iniciar sesión”.' : '¿No tienes cuenta? Cambia a “Crear cuenta”.';
        // estilo de pestañas
        $('tabLogin').className = isReg ? '' : 'primary';
        $('tabRegister').className = isReg ? 'primary' : '';
      }
      $('tabLogin').addEventListener('click', ()=> { setMode('login'); syncIlluHeight(); });
      $('tabRegister').addEventListener('click', ()=> { setMode('register'); syncIlluHeight(); });
      setMode('login');

      async function submitAuth(){
        const email = ($('email').value||'').trim().toLowerCase();
        const password = $('password').value;
        const msg = $('authMsg');
        msg.textContent = '';
        if(!email || !password){ msg.textContent = 'Completa email y contraseña.'; return; }
        try{
          if(mode === 'register'){
            const name = ($('name').value||'').trim();
            if(!name){ msg.textContent = 'Añade tu nombre para registrarte.'; return; }
            const { data, error } = await supabase.auth.signUp({ email, password, options:{ data:{ name } } });
            if(error){ msg.textContent = 'Error: ' + error.message; return; }
            if(data.session){
              enableNavLinks(); showUserMenu(name);
              msg.textContent = 'Registro correcto. ¡Bienvenido!';
            } else { msg.textContent = 'Revisa tu correo para confirmar el registro.'; }
          } else {
            const { data, error } = await supabase.auth.signInWithPassword({ email, password });
            if(error){ msg.textContent = 'Credenciales inválidas'; return; }
            const { data: u } = await supabase.auth.getUser();
            const name = u?.user?.user_metadata?.name || email.split('@')[0];
            enableNavLinks(); showUserMenu(name);
            msg.textContent = 'Sesión iniciada.';
          }
        }catch(e){ msg.textContent = 'Error inesperado.'; }
      }
      $('authSubmit').addEventListener('click', async () => { await submitAuth(); syncIlluHeight(); });

      // Igualar altura entre tarjeta de auth e imagen lateral
      function syncIlluHeight(){
        const card = document.getElementById('authCard');
        const illu = document.querySelector('.illu');
        if(card && illu){ illu.style.height = card.offsetHeight + 'px'; }
      }
      window.addEventListener('load', syncIlluHeight);
      window.addEventListener('resize', () => requestAnimationFrame(syncIlluHeight));

      // Si hay sesión, habilitar navegación al cargar; si no, mostrar aviso al pulsar
      (async () => {
        const { data } = await supabase.auth.getUser();
        if (data?.user){
          enableNavLinks();
          const name = data.user.user_metadata?.name || (data.user.email ? data.user.email.split('@')[0] : '');
          showUserMenu(name);
        }
        document.querySelectorAll('[data-route].locked')?.forEach(a=>{
          a.addEventListener('click', (e)=>{ e.preventDefault(); alert('Inicia sesión para acceder a esta sección.'); });
        });
        // Mobile menu handlers
        const mm = document.getElementById('mobileMenu');
        const open = document.getElementById('burgerBtn');
        const close = document.getElementById('mobileClose');
        open?.addEventListener('click', ()=>{ mm?.classList.add('open'); mm?.setAttribute('aria-hidden','false'); });
        close?.addEventListener('click', ()=>{ mm?.classList.remove('open'); mm?.setAttribute('aria-hidden','true'); });
        mm?.addEventListener('click', (e)=>{ if(e.target === mm){ mm.classList.remove('open'); mm.setAttribute('aria-hidden','true'); } });
      })();
    </script>
  </body>
  </html>
